---
description: 交互逻辑文档
globs: 
alwaysApply: false
---
# 交互逻辑文档 - Gemini 内容导出与美化插件

**1. 引言**

本文档旨在详细描述"Gemini 内容导出与美化插件"的用户交互流程和界面操作逻辑。它基于已定义的项目需求文档 (`cursor_rules.mdc`)，为插件的UI/UX设计和开发提供指导。

**2. 核心调用与模式选择**

*   **2.1. 访问导出选项 (在 Gemini 界面内)**
    *   **触发点**: 插件将增强 Gemini 原生回答框或深度研究报告下方的现有"复制"和/或"分享"按钮/图标的功能。
    *   **交互方式**:
        1.  用户用鼠标点击 Gemini 原有的"复制"或"分享"按钮（或其附近新增强的统一"导出"图标）上。
        2.  出现清晰的工具提示（Tooltip），如"导出内容"。
        3.  用户点击该按钮/图标。
        4.  弹出一个简洁的子菜单或下拉列表，提供以下选项：
            *   "复制为 Markdown"
            *   "下载为 Markdown (.md)" (基于需求文档 3.2.3 - 可选)
            *   "导出为图片 (自定义海报)"
    *   **视觉反馈**: 交互元素应有清晰的 hover 和 active 状态。

**3. "导出为 Markdown" 流程**

*   **3.1. 初始化**: 用户从导出选项菜单中选择"复制为 Markdown"或"下载为 Markdown (.md)"。
*   **3.2. 内容处理**: 
    1.  插件自动捕获当前选定或关联的 Gemini 内容块 (HTML 格式)。
    2.  后台调用 `Turndown` 库将捕获到的 HTML 转换为 Markdown 格式的文本。
*   **3.3. 用户后续操作与反馈**:
    *   **若选择"复制为 Markdown"**: 
        1.  转换后的 Markdown 文本自动复制到用户剪贴板。
        2.  界面给出即时、短暂的成功提示，如："Markdown 已复制到剪贴板！" (例如，一个小的 toast 通知)。
    *   **若选择"下载为 Markdown (.md)"** (可选功能):
        1.  触发浏览器标准的"文件另存为"对话框。
        2.  默认文件名可设为 `gemini_export_YYYYMMDD_HHMMSS.md` 或从内容中提取部分标题。
        3.  下载完成后，可有短暂提示，如："Markdown 文件已开始下载。"

**4. "导出为图片 (自定义海报)" 流程**

*   **4.1. 初始化**: 用户从导出选项菜单中选择"导出为图片 (自定义海报)"。
*   **4.2. 内容捕获**: 
    1.  插件自动捕获当前选定或关联的 Gemini 内容块 (原始 HTML 格式，以便后续在编辑器中渲染或转换为 Markdown 再渲染)。
*   **4.3. 启动 Web UI 编辑器**:
    *   **展现方式**: 以模态窗口 (Modal) 的形式在当前 Gemini 页面之上打开。模态窗口应占据页面较大部分，提供充足的编辑空间。
    *   **初始状态**: 
        1.  捕获的 Gemini 内容被加载到编辑器中央的预览区域。
        2.  默认应用一套预设的、美观的海报模板和主题 (例如，基于 `markdown-to-image` 的默认主题)。
*   **4.4. Web UI 编辑器交互详解** (基于 React 和 `markdown-to-image` 组件的预期交互):
    *   **4.4.1. 画布/背景自定义**: 
        *   **控件**: 侧边栏或顶部工具栏提供背景设置选项。
            *   纯色背景: 提供颜色选择器 (color picker)。
            *   渐变背景: 提供渐变方向、起始/结束颜色选择器。
            *   上传背景图片: 提供文件上传按钮，支持常见图片格式 (JPG, PNG)。
        *   **反馈**: 用户的任何更改都应实时反映在主预览区域。
    *   **4.4.2. 文本样式调整**: 
        *   **选择**: 用户可能需要能够点选预览区内的特定文本块进行局部样式调整（如果 `markdown-to-image` 支持），或提供全局文本样式设置。
        *   **控件**: 提供字体选择下拉菜单 (预置几款免费商用字体)、字号调整 (输入框/滑块)、字体颜色选择器、行高/段间距调整。
        *   **反馈**: 样式更改实时预览。
    *   **4.4.3. 元素添加/管理**: 
        *   **控件**: 
            *   Gemini Logo/来源标识: 提供开关 (toggle) 来显示/隐藏，或选择不同样式的来源标识。
            *   自定义文本/水印: 提供"添加文本"按钮，点击后可在画布上添加新的文本框，用户可编辑内容、调整样式和位置（拖拽）。
        *   **反馈**: 实时预览。
    *   **4.4.4. 布局调整**: 
        *   **控件**: 提供调整内容区域内边距 (padding)、内容对齐方式 (左/中/右，如果适用) 的控件。
        *   **反馈**: 实时预览。
    *   **4.4.5. 主题/模板选择**: 
        *   **控件**: 提供一个包含多种预设主题/模板的缩略图列表或下拉菜单 (借鉴 `markdown-to-image` 的主题功能)。
        *   **交互**: 用户点击某个主题/模板后，预览区域的海报样式立即更新。
    *   **4.4.6. 实时预览窗格**: 
        *   **核心区域**: 编辑器中央始终显示当前海报的最终外观预览。
        *   **响应式**: 预览应能反映不同设置下的最终输出效果。
*   **4.5. 完成与导出图片**:
    *   **触发**: 编辑器界面提供一个醒目的"生成并下载图片"或类似按钮。
    *   **预处理**: 用户点击后，插件使用 `html2canvas` (或 `markdown-to-image` 内建的导出机制) 将当前预览区域的 DOM 元素（或其代表的 Markdown 内容）渲染为图片数据。
    *   **格式选择**: (可选) 在下载前，允许用户选择导出格式 (PNG/JPEG) 和图片质量。
    *   **下载**: 触发浏览器标准的"文件另存为"对话框，默认文件名可为 `gemini_poster_YYYYMMDD_HHMMSS.png/jpg`。
    *   **反馈**: 下载开始后，编辑器界面给出成功提示，如"图片已开始下载！"，模态窗口可自动关闭或提供关闭按钮。
    *   **(可选) 复制图片到剪贴板**: 提供"复制图片"按钮。点击后尝试将生成的图片复制到剪贴板。成功或失败均需给出明确提示（如"图片已复制！"或"复制图片失败，请尝试下载。"）。

**5. 插件图标交互 (浏览器工具栏)**

*   **5.1. 点击图标** (根据需求文档 3.4.2，此为可选功能):
    *   **行为**: 用户点击浏览器工具栏上的插件图标。
    *   **结果**: 弹出一个小型的 HTML 页面 (popup.html)。
    *   **Popup 内容**: 
        *   提供插件的简要说明。
        *   (可选) 快捷设置：如默认导出格式、默认图片质量等。
        *   链接到帮助/关于信息。
        *   (可选) 快速启用/禁用某些特性。

**6. 用户反馈与通知**

*   **6.1. 成功操作**: 
    *   对于快速操作（如复制 Markdown），使用简短、自消失的 Toast 通知 (例如："已复制到剪贴板")。
    *   对于下载操作，通知用户下载已开始。
*   **6.2. 进行中/加载状态**: 
    *   对于耗时可能较长操作（如复杂海报的首次渲染或生成图片），应在相关按钮或区域显示加载指示器 (spinner) 或进度提示，避免用户感觉程序无响应。
*   **6.3. 错误处理**: 
    *   **内容捕获失败**: 如果插件未能正确识别或捕获 Gemini 内容，应给出友好提示，如"未能捕获内容，请确保已选中 Gemini 的回答或报告后再试。"
    *   **转换/生成失败**: 如果 Markdown 转换或图片生成过程中出错，提示用户"处理失败，请稍后再试或联系支持。"
    *   **权限问题**: 如果缺少必要权限（尽管 Manifest V3 权限声明应尽可能减少这种情况），应引导用户如何授予。
    *   所有错误提示都应清晰易懂，并尽可能提供解决方案或重试选项。

**7. 交互一致性与特殊场景**

*   **7.1. 无可选内容时**: 如果当前 Gemini 页面没有可供导出的回答或报告，或者用户未聚焦于任何特定内容块，插件的导出按钮应处于禁用 (disabled) 状态，或点击后提示"请先选择或聚焦于一个 Gemini 回答/报告"。
*   **7.2. 编辑器中的超大内容**: 
    *   在海报编辑器预览中，如果捕获的内容非常长，默认应允许内容在指定的文本区域内垂直滚动。
    *   用户可以通过调整字体大小或内容选择来优化显示。
    *   可考虑提示用户内容过长可能影响海报美观度。
*   **7.3. Gemini 页面结构变更的应对**: 
    *   插件应设计得具有一定的鲁棒性，以应对 Gemini 前端 DOM 结构的微小变化。
    *   如果发生重大变更导致插件核心功能失效，当用户尝试使用时，应给出明确提示，例如："Gemini 页面结构已更新，插件暂时无法工作，请等待开发者更新。"
*   **7.4. 快捷键**: (未来扩展) 可考虑为常用操作（如打开编辑器、复制 Markdown）提供自定义快捷键支持。

本文档描述了核心的交互流程。在具体实现过程中，UI 设计师和开发者应紧密合作，确保用户体验的流畅与直观。
